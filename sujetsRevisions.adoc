= TP Révisions PHP : POO & Algorithmique
:author: Timothée Robert
:revdate: 2026-01-12
:toc: left
:toc-title: Sommaire
:icons: font
:source-highlighter: highlight.js
:sectnums:

== Contexte & Objectifs

Ce TP a pour but de consolider vos acquis en **PHP 8** orienté objet. Nous travaillerons sur un modèle de gestion scolaire (Étudiants, Notes, Planning) respectant une architecture stricte (Namespaces, Encapsulation).

*Objectifs pédagogiques :*

* Manipuler des collections d'objets (`array` de classes).
* Utiliser l'encapsulation (Getters).
* Naviguer dans les associations (Ex: `Etudiant` -> `Filiere`).
* Implémenter des algorithmes de base (Somme, Moyenne, Recherche de maximum).

[IMPORTANT]
====
Le respect de l'encapsulation est obligatoire. L'accès direct aux attributs (ex: `$e->nom`) est interdit. Vous devez utiliser les accesseurs (ex: `$e->getNom()`).
====

== Préparation des Données

Avant de commencer les exercices, assurez-vous que votre fichier `index.php` (ou votre script de test) contient bien les instances nécessaires.

En plus du tableau `$etudiants` déjà créé, ajoutez les tableaux suivants pour les exercices 4 et 5 :

[source,php]
----
// À ajouter dans votre fichier index.php

// Instanciation de salles
$salles = [
    new Salle(1, "B202", 2, 30, 15),
    new Salle(2, "A101", 1, 20, 20),
    new Salle(3, "C004", 0, 40, 0)
];

// Instanciation de planning
// (Supposons que les objets Matiere, Enseignant, Salle existent déjà)
$plannings = [
    new Planning(1, "S42", "Lundi", 4, $matCyber, $profTuring, $salles[0]),
    new Planning(2, "S42", "Mardi", 2, $matWeb, $profTuring, $salles[1]),
    new Planning(3, "S43", "Jeudi", 3, $matCyber, $profLovelace, $salles[0])
];
----



== Exercice 1 : Filtrage simple
*Objectif : Conditions et navigation dans les objets liés.*

Parcourez le tableau `$etudiants`. Affichez le **Nom** et le **Prénom** uniquement des étudiants qui sont inscrits dans l'option **"SLAM"**.

* Si l'option n'est pas "SLAM", l'étudiant ne doit pas apparaître.
* Format attendu : `Dupont Marie (SLAM)`

[TIP]
====
Vous devrez enchaîner les appels de méthodes pour atteindre l'information :
`$etudiant->getFiliere()->getOption()`
====

== Exercice 2 : Calcul de Moyenne Pondérée
*Objectif : Algorithme de cumul et gestion des cas limites.*

Pour chaque étudiant, calculez sa moyenne générale en tenant compte des coefficients des évaluations.

. **Formule** : stem:[(sum ("Note" xx "Coef")) / (sum "Coefs")]
. **Règle de gestion** : Si un étudiant n'a aucune note, affichez "Pas de notation" (ne pas diviser par zéro).
. **Affichage** : `Prénom Nom : Moyenne / 20` (arrondir à 2 décimales).

[source,php]
----
// Structure d'aide
$totalPoints = 0;
$totalCoefs = 0;
foreach ($etudiant->getEvaluations() as $eval) {
    // Votre logique de cumul ici
}
----

== Exercice 3 : Recherche Multicritère
*Objectif : Exploration d'objets imbriqués.*

Nous souhaitons auditer le travail de l'enseignant **M. Turing**.
Parcourez tous les étudiants et toutes leurs évaluations respectives.

Affichez toutes les notes qui ont été attribuées par l'enseignant dont le nom est "Turing".

* **Format de sortie :**
> "Note de 15/20 donnée par M. Turing à l'étudiant Dupont en Développement Web."

[NOTE]
====
Cela nécessite deux boucles imbriquées (`foreach` étudiant -> `foreach` évaluation) et un test sur le nom de l'enseignant lié à l'évaluation.
====

== Exercice 4 : Gestion de Planning (Charge horaire)
*Objectif : Somme conditionnelle sur collection simple.*

On souhaite connaître la charge horaire globale de la semaine **"S42"**.

Parcourez votre tableau `$plannings`. Calculez et affichez le nombre total d'heures de cours prévues pour la semaine "S42".

* Utilisez `$planning->getSemaine()` pour filtrer.
* Utilisez `$planning->getDuree()` pour cumuler.

== Exercice 5 : Inventaire & Statistiques
*Objectif : Algorithme de recherche de maximum.*

L'administration souhaite un état des lieux des salles (tableau `$salles`).

. **Total PC** : Calculez le nombre total de postes informatiques disponibles dans tout l'établissement.
. **Capacité Max** : Identifiez (via un algorithme) et affichez le *Code* de la salle qui possède la plus grande capacité d'accueil d'élèves.

[TIP]
====
Pour la recherche du maximum, initialisez une variable `$maxCapacite = 0` et une variable `$salleGagnante = null` avant la boucle. Mettez-les à jour dès que vous trouvez une capacité supérieure à la précédente.
====

== Exercice 6 : Gestion des Dates (Mineurs vs Majeurs)
*Objectif : Manipulation de l'objet `DateTime` et intervalles.*

L'administration doit identifier les étudiants mineurs pour demander des autorisations parentales.
La date de référence pour le calcul est la date actuelle (`new DateTime("now")`).

. Parcourez la liste des étudiants.
. Calculez l'âge de chacun en utilisant la méthode `diff()` entre la date du jour et la date de naissance.
. Affichez :
* Si l'étudiant a moins de 18 ans : `[ALERTE] Prénom Nom est mineur (X ans).`
* Sinon : `Prénom Nom est majeur.`

[TIP]
====
La méthode `diff()` retourne un objet `DateInterval`. La propriété `y` de cet objet contient le nombre d'années.
Exemple : `$age = $dateNaissance->diff($dateActuelle)->y;`
====

== Exercice 7 : Logique Métier (Validation du Bloc 1)
*Objectif : Filtrage avancé sur des sous-ensembles de données.*

Pour obtenir le diplôme, il faut avoir la moyenne (>= 10) spécifiquement dans les matières du **"Bloc 1"**.

. Pour chaque étudiant, isolez uniquement les notes concernant des matières dont le code bloc est "Bloc 1".
. Calculez la moyenne de ces notes spécifiques.
. Affichez si l'étudiant a validé ou non le Bloc 1.

*Sortie attendue :*
> "Marie Dupont : Bloc 1 VALIDÉ (15/20)" +
> "Lucas Martin : Bloc 1 NON VALIDÉ (8.5/20)"

[NOTE]
====
Vous devez vérifier `$eval->getMatiere()->getCodeBloc() === "Bloc 1"` à l'intérieur de la boucle des évaluations.
====

== Exercice 8 : Agrégation de Données (Charge Enseignant)
*Objectif : Utilisation de tableaux associatifs comme accumulateurs.*

On souhaite savoir combien d'heures de cours assure chaque enseignant sur la semaine S42, en se basant sur le tableau `$plannings`.

. Créez un tableau vide `$heuresParProf = []`.
. Parcourez les plannings de la semaine **S42**.
. Pour chaque créneau, utilisez le nom de l'enseignant comme **clé** du tableau associatif et ajoutez la durée à la valeur.
. À la fin, affichez le résultat.

*Algorithme suggéré :*
[source,php]
----
$nomProf = $planning->getEnseignant()->getNom();
if (!isset($heuresParProf[$nomProf])) {
    $heuresParProf[$nomProf] = 0;
}
$heuresParProf[$nomProf] += $planning->getDuree();
----

== Exercice 9 : Manipulation de Chaînes (Génération d'emails)
*Objectif : Nettoyage de chaînes et concaténation.*

Le service informatique doit créer les comptes Active Directory. Le format de l'email doit être : `prenom.nom@ecole-sio.fr`.

. Parcourez les étudiants.
. Générez l'adresse email en respectant les contraintes suivantes :
* Tout en minuscules (`strtolower`).
* Pas d'espaces (remplacer par rien ou des tirets).
. Affichez : `Nom complet -> email généré`.

*Exemple :*
> Marie Dupont -> marie.dupont@ecole-sio.fr

== Exercice 10 : Génération de Vue (Composant HTML)
*Objectif : Créer une liste déroulante dynamique.*

Pour un formulaire d'affectation de salle, on a besoin d'une liste déroulante HTML (`<select>`) contenant tous les enseignants disponibles.

. Parcourez le tableau (ou la liste) des enseignants (vous pouvez le déduire des objets `$plannings` si vous n'avez pas de liste distincte, ou utiliser une liste `$enseignants` créée manuellement).
. Générez le code HTML suivant :

[source,html]
----
<select name="enseignant">
    <option value="1">Turing Alan</option>
    <option value="2">Lovelace Ada</option>
</select>
----

*Contraintes :*

* La `value` de l'option doit être l'**ID** de l'enseignant.
* Le texte affiché doit être le **Nom** suivi du **Prénom**.